<script>
// npm install fast-base64-decode
var lookup = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 62, 0, 62, 0, 63, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 0, 0, 0, 0, 63, 0, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51]

function base64Decode (source, target) {
  var sourceLength = source.length
  var paddingLength = (source[sourceLength - 2] === '=' ? 2 : (source[sourceLength - 1] === '=' ? 1 : 0))

  var tmp
  var byteIndex = 0
  var baseLength = (sourceLength - paddingLength) & 0xfffffffc

  //for (var i = 0; i < baseLength; i += 4) {
    for (var i = 0; i < sourceLength; i += 4) {
    tmp = (lookup[source.charCodeAt(i)] << 18) | (lookup[source.charCodeAt(i + 1)] << 12) | (lookup[source.charCodeAt(i + 2)] << 6) | (lookup[source.charCodeAt(i + 3)])

    target[byteIndex++] = (tmp >> 16) & 0xFF
    target[byteIndex++] = (tmp >> 8) & 0xFF
    target[byteIndex++] = (tmp) & 0xFF
  }

  if (paddingLength === 1) {
    tmp = (lookup[source.charCodeAt(i)] << 10) | (lookup[source.charCodeAt(i + 1)] << 4) | (lookup[source.charCodeAt(i + 2)] >> 2)

    target[byteIndex++] = (tmp >> 8) & 0xFF
    target[byteIndex++] = tmp & 0xFF
  }

  if (paddingLength === 2) {
    tmp = (lookup[source.charCodeAt(i)] << 2) | (lookup[source.charCodeAt(i + 1)] >> 4)

    target[byteIndex++] = tmp & 0xFF
  }
}
</script>

<html>
<body>
  <video id="video" autoplay></video>
  <canvas width="640" id="canvas" height="480" style="display:none;"></canvas>
  <div class="obj" style="
    position: absolute;
    background: red;
    height: 20px;
    width: 20px;
    top: 0px;
  "></div>
  <div id="stats" style="
    position: absolute;
    font-size: 40;
    color: white;
    top: 0px;
  ">
  No write.
  </div>
  <script>
    canvas = document.getElementById('canvas')
    context = canvas.getContext('2d')
    navigator.mediaDevices.getUserMedia({
      audio: false,
      video: {
        width: 640,
        height: 480,
        facingMode: 'environment'
      }
    })
    .then(stream => {
      document.getElementById('video').srcObject = stream
    })
    i = 0
    range = 50
    voffset = 50
    obj = document.getElementsByClassName('obj')[0]
    stats = document.getElementById('stats')
    animation_interval = setInterval(() => {
      obj.style.top = voffset + range/2 + range * Math.sin(i / 100) + 'px'
      i = i + 1
      context.drawImage(video, 0, 0, 640, 480)
      //data = canvas.getImageData()
      data = canvas.toDataURL("image/jpeg")
      a = 0
      for (j = 1000; j < 1100; j++) {
        result = new Uint8Array(1)
        a = data.slice(j, j+1)
        base64Decode(a, result)
      }
      stats.innerHTML = a + result.join('')
    }, 20)
  </script>
</body>
</html>
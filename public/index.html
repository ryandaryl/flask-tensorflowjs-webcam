<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@0.11.7"></script>
<script src="https://cdn.jsdelivr.net/gh/nicolaspanel/numjs@0.15.1/dist/numjs.min.js"></script>
<html>
<body>
  <video id="video" autoplay></video>
  <canvas width="320" id="canvas" height="240" style="display:none;"></canvas>
  <div class="obj" style="
    position: absolute;
    background: red;
    height: 20px;
    width: 20px;
    top: 0px;
  "></div>
  <div id="stats" style="
    position: absolute;
    font-size: 40;
    color: white;
    top: 0px;
  ">
  No write.
  </div>
  <script>
    canvas = document.getElementById('canvas')
    context = canvas.getContext('2d')
    navigator.mediaDevices.getUserMedia({
      audio: false,
      video: {
        width: 640,
        height: 480,
        facingMode: 'environment'
      }
    })
    .then(stream => {
      document.getElementById('video').srcObject = stream
    })
    i = 0
    range = 50
    voffset = 50
    obj = document.getElementsByClassName('obj')[0]
    stats = document.getElementById('stats')
    last_time = Date.now()
    animation_interval = setInterval(() => {
      obj.style.top = voffset + range/2 + range * Math.sin(i / 100) + 'px'
      i = i + 1
      context.drawImage(video, 0, 0, 320, 240)
      data = context.getImageData(0, 0, 320, 240).data
      //data = canvas.toDataURL("image/jpeg")

      a = 100
      b = 40
      c = 100
      array1 = nj.random([a,b]).tolist()
      m = tf.tensor2d(array1, [a, b])
      array2 = nj.random([b,c]).tolist()
      n = tf.tensor2d(array2, [b, c])
      d = m.matMul(n)

      now = Date.now()
      stats.innerHTML = parseInt(1000 / (now - last_time)) + ' ' + data[1000]
      last_time = now
    }, 20)
  </script>
</body>
</html>